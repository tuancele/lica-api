# 智能产品推荐系统

## 概述

这是一个专门为化妆品电商平台设计的智能产品推荐系统，能够根据用户行为（浏览、点击、购买等）自动推荐合适的产品。

## 功能特性

1. **全面的用户行为跟踪**
   - 自动跟踪用户浏览、点击、添加到购物车、购买等行为
   - 收集IP地址、地理位置、设备信息
   - 跟踪滚动深度、图片查看、描述阅读等深度交互
   - 支持匿名用户（基于会话ID）和登录用户

2. **多种推荐策略**
   - **协同过滤**：基于相似用户的行为推荐
   - **内容过滤**：基于产品分类、品牌、成分的相似性推荐
   - **热门产品**：推荐浏览量高的热门产品
   - **最新产品**：推荐最新上架的产品

3. **智能缓存**
   - 推荐结果缓存30分钟，提高性能
   - 用户行为更新时自动清除相关缓存

4. **前端集成**
   - 自动跟踪用户行为
   - 动态加载推荐产品
   - 响应式设计，适配移动端
   - 支持lazy-load机制

## 安装步骤

### 1. 运行数据库迁移

```bash
php artisan migrate
```

这将创建 `user_behaviors` 表用于存储用户行为数据。

### 2. 系统已自动集成

- JavaScript脚本已添加到 `app/Themes/Website/Views/layout.blade.php`
- 推荐区块已添加到首页和产品详情页
- API路由已配置在 `routes/api.php`

## 使用方法

### 自动显示（已集成）

系统已在以下位置自动显示推荐：
- **首页**：在"Top sản phẩm bán chạy"下方
- **产品详情页**：在页面底部

### 在其他位置添加推荐

在任何Blade模板中添加：

```blade
<div class="product-recommendations-home" 
     data-exclude="1,2,3" 
     data-limit="12">
    <!-- 推荐产品将自动加载 -->
</div>
```

**属性说明：**
- `data-exclude`: 要排除的产品ID（用逗号分隔）
- `data-limit`: 显示的产品数量（默认12）

### API端点

- `GET /api/recommendations` - 获取推荐产品
- `POST /api/recommendations/track` - 跟踪用户行为
- `GET /api/recommendations/history` - 获取浏览历史
- `GET /api/analytics/user-history` - 获取用户浏览历史（用于分析）
- `GET /api/analytics/user-preferences` - 分析用户偏好
- `GET /api/analytics/export-ai` - 导出数据用于AI训练

## 推荐算法

系统使用4种策略（按优先级）：

1. **协同过滤**：找到与当前用户浏览历史相似的其他用户，推荐他们浏览但当前用户未浏览的产品
2. **内容过滤**：基于产品分类和品牌相似性推荐
3. **热门产品**：按浏览量排序
4. **最新产品**：按创建时间排序

## 数据收集

系统自动收集以下数据：
- 用户信息：IP、地理位置、设备类型、浏览器、操作系统
- 产品信息：分类、品牌、成分、特点
- 行为数据：浏览时长、滚动深度、交互行为

## 性能优化

1. **缓存策略**：推荐结果缓存30分钟
2. **批量处理**：用户行为跟踪使用队列批量发送
3. **防抖处理**：避免频繁的API调用
4. **数据库索引**：已为常用查询字段添加索引

## 注意事项

1. **隐私保护**：系统使用会话ID跟踪匿名用户，不会收集个人敏感信息
2. **性能影响**：用户行为跟踪是异步的，不会影响页面加载速度
3. **数据清理**：建议定期清理30天前的旧数据
4. **图片URL**：系统使用`getImage()`函数处理图片，支持R2媒体URL

## 故障排除

如果推荐不显示：
1. 检查浏览器控制台是否有JavaScript错误
2. 确认API路由可访问：`/api/recommendations`
3. 检查数据库连接和表结构
4. 查看Laravel日志文件

## 技术支持

详细文档请查看：
- `HUONG_DAN_SU_DUNG.md` - 使用指南（越南语）
- `COSMETICS_AI_DATA_COLLECTION.md` - 数据收集文档
