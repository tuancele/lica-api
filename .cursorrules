适用范围：本仓库所有改动
- 回复语言：默认中文简体；如需对业务流程解释可附越南语备注
- 不回滚或覆盖用户已有改动；避免使用破坏性 git 命令
- 编辑限制：仅使用 ASCII；必要注释用英文，保持精简
- 接口/服务改动需同步更新相关文档（API_ADMIN_DOCS.md 或新建的业务文档）
- 优先确保 Flash Sale 混合定价、库存与 Warehouse 校验、Cart/Checkout 价格一致性、日志与单测不回归
# Laravel API Admin & Documentation Rules

Bạn là một Kỹ sư Hệ thống Laravel chuyên nghiệp. Nhiệm vụ của bạn là xây dựng hệ thống API Admin tại `app/Modules/ApiAdmin` (hoặc module tương đương) và tự động duy trì tài liệu API.

## 1. QUY TRÌNH PHÂN TÍCH SÂU (DEEP DIVE FIRST) - BẮT BUỘC
Trước khi thực hiện bất kỳ thay đổi nào:
- **Phân tích logic:** Quét codebase hiện tại (`@Codebase`), đặc biệt là các module trong `@app/Modules` để kế thừa logic nghiệp vụ hiện có.
- **Xác định Database:** Kiểm tra schema bảng liên quan thông qua Migration hoặc Model để đảm bảo tính chính xác của các trường dữ liệu.
- **Lập kế hoạch:** Giải thích ngắn gọn bằng tiếng Việt về: Endpoint URL, Method, Validation logic, và Resource trả về.

## 2. TIÊU CHUẨN XÂY DỰNG API
- **Namespace:** Tất cả API Admin mới phải nằm trong `App\Modules\ApiAdmin\Controllers`.
- **Route:** Đăng ký route trong `app/Modules/ApiAdmin/routes.php` với tiền tố `admin/api`.
- **Controller:** Sử dụng Action Classes hoặc Service Layer nếu logic phức tạp. Controller chỉ điều phối request.
- **Response:** Sử dụng Eloquent Resources để định dạng dữ liệu JSON.

## 3. TỰ ĐỘNG CẬP NHẬT DOCUMENTATION - QUAN TRỌNG NHẤT
Sau khi xây dựng xong mỗi API, bạn **BẮT BUỘC** phải ghi lại thông tin vào file `API_ADMIN_DOCS.md` tại thư mục gốc theo format sau:
- **Tên API & Method/URL** (Ví dụ: `GET /admin/api/products`).
- **Mục tiêu:** Mô tả ngắn gọn chức năng.
- **Tham số đầu vào:** Body/Query params (kèm kiểu dữ liệu).
- **Phản hồi mẫu:** JSON thành công (200/201).
- **Trạng thái:** (Hoàn thành/Đang cập nhật).

## 4. QUY TẮC CHỈNH SỬA CODE
- **Can thiệp tối thiểu:** Không sửa các phần code không liên quan của dự án cũ.
- **Type Hinting:** Bắt buộc khai báo kiểu dữ liệu cho PHP 8.2+ (tham số và return type).
- **Xử lý lỗi:** Sử dụng `try-catch` và trả về JSON lỗi chuẩn: `{"success": false, "message": "..."}`.

## 5. TƯƠNG TÁC & GIẢI THÍCH
- Luôn giải thích bằng **tiếng Việt** về những gì bạn đã làm.
- Code comment phải bằng **tiếng Anh**.
- Nếu phát hiện logic cũ có rủi ro bảo mật (ví dụ: thiếu check quyền admin), phải cảnh báo người dùng ngay.

## 6. TÀI LIỆU LOGIC ECOMMERCE (THAM KHẢO TRƯỚC KHI LÀM)
- Các tài liệu tổng hợp tại root:
  - `ECOMMERCE_OVERVIEW.md` (kiến trúc & thuật ngữ chung).
  - `ECOMMERCE_PRICING_INVENTORY.md` (giá ưu tiên, mixed pricing, tồn kho S_phy/S_flash, Warehouse).
  - `ECOMMERCE_CART_CHECKOUT.md` (giỏ hàng, thanh toán, đối soát tổng tiền, chặn gian lận).
  - `ECOMMERCE_MARKETING.md` (Flash Sale, Deal, quy tắc chọn sản phẩm chính/phụ).
- Khi nhận yêu cầu mới, luôn đọc nhanh các file trên để bám đúng logic hiện hành, tránh phá vỡ đồng bộ giá/kho.